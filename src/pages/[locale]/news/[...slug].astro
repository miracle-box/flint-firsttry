---
import type { Locales, NewsPageProps, NewsPageProps as Props } from '~/types';
import Layout from '~/layouts/news-content.astro';
import { locales } from '~/utils/i18n';
import { fetchNews } from '~/utils/news';

const { contentProps, pageProps } = Astro.props;

type Path = {
	params: {
		locale: Locales;
		slug: string;
	};
	props: NewsPageProps;
};

export async function getStaticPaths() {
	const paths = [];
	const allPages = await fetchNews();

	for (const locale of locales) {
		const pages = allPages.map(
			(p, index): Path => ({
				params: { locale, slug: p.slug },
				props: {
					contentProps: p,
					pageProps: {
						prevPost: allPages[index + 1],
						nextPost: allPages[index - 1],
					},
				},
			}),
		);

		paths.push(...pages);
	}

	return paths;
}
---

<Layout contentProps={contentProps} pageProps={pageProps}>
	<contentProps.Content />
</Layout>
