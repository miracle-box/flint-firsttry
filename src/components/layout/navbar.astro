---
import type { Locales } from '~/types';
import { siteConfig, localeNames } from '~/config';
import { loadLocale, i18nObject, getLocaleFromUrl, changePathLocale } from '~/utils/i18n';
import { NavPopper } from '~/components/layout/nav-popper';
import { LanguageIcon } from '~/components/icon/language';
import { MenuIcon } from '~/components/icon/menu';

const { url } = Astro;
const locale = getLocaleFromUrl(url.pathname);
await loadLocale(locale);
const t = i18nObject(locale);

function getLocaleItems() {
	return Object.entries(localeNames).map(([locale, locName]) => {
		return {
			locName,
			link: changePathLocale(url.pathname, locale as Locales),
		};
	});
}

const navItems = [
	{
		link: `/${locale}/news/`,
		text: t.navItems.news(),
	},
	{
		link: `/${locale}/docs/`,
		text: t.navItems.docs(),
	},
	{
		link: '#',
		text: t.navItems.resources(),
	},
	{
		link: 'https://spark.yaasasi.cn/',
		text: t.navItems.guiluo(),
	},
];
---

<nav class="container top-0 mx-auto flex items-center justify-between px-4 py-3 text-md font-semibold">
	<!-- Left -->
	<div class="flex items-center gap-4">
		<!-- Logo -->
		<a class="flex items-center gap-1 rounded outline-none ring-gray-200 focus:ring" href={`/${locale}/`}>
			<img class="h-8 w-8" src={siteConfig.site.logoImg} alt={t.site.logoAlt()} />
			<span>{t.site.logotype()}</span>
		</a>
		<!-- Links -->
		<div class="hidden gap-1 md:flex">
			{
				navItems.map(({ text, link }) => (
					<a class="nav-link" href={link}>
						{text}
					</a>
				))
			}
		</div>
	</div>
	<!-- Right -->
	<div class="flex items-center">
		<!-- Language Selector -->
		<NavPopper class:list="ml-4" icon={LanguageIcon} client:load>
			<div>
				<div class="flex flex-col gap-2">
					{
						getLocaleItems().map(({ locName, link }) => (
							<a class="nav-link" href={link}>
								{locName}
							</a>
						))
					}
				</div>
			</div>
		</NavPopper>
		<!-- Mobile Nav -->
		<div class="ml-4 md:hidden">
			<NavPopper icon={MenuIcon} client:load>
				<div>
					<div class="flex flex-col gap-2">
						{
							navItems.map(({ text, link }) => (
								<a class="nav-link" href={link}>
									{text}
								</a>
							))
						}
					</div>
				</div>
			</NavPopper>
		</div>
	</div>
</nav>

<style>
	.nav-link {
		@apply rounded px-3 py-2 transition-colors;
		@apply text-gray-600 hover:bg-gray-100 hover:text-gray-900;
		@apply outline-none ring-gray-200 focus:ring;
	}
</style>
